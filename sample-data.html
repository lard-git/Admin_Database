<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Band Pattern Data</title>
    <!-- Use Firebase compat version -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .pattern-option {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s;
            width: 300px;
        }
        
        .pattern-option:hover {
            border-color: #2196f3;
            transform: translateY(-2px);
        }
        
        .pattern-option.selected {
            border-color: #2196f3;
            background: #e7f3ff;
        }
        
        .pattern-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pattern-desc {
            color: #666;
            font-size: 0.9em;
            margin-left: 30px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin: 20px 0;
            width: 300px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            background: #764ba2;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.success {
            background: #4caf50;
        }
        
        .notification.error {
            background: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pattern-selector">
            
            <div class="pattern-option" data-pattern="double-peak" onclick="selectPattern('double-peak')">
                <div class="pattern-title">Double Peak Pattern</div>
                <div class="pattern-desc">Strong morning (7-9am) & evening (5-8pm) peaks, +15% weekly growth</div>
            </div>
            
            <div class="pattern-option" data-pattern="evening-heavy" onclick="selectPattern('evening-heavy')">
                <div class="pattern-title">Evening Heavy Pattern</div>
                <div class="pattern-desc">Massive evening rush (5-10pm), stable +5% weekly growth</div>
            </div>
            
            <div class="pattern-option" data-pattern="morning-rush" onclick="selectPattern('morning-rush')">
                <div class="pattern-title">Morning Rush Pattern</div>
                <div class="pattern-desc">Intense morning traffic (5-10am), declining -8% weekly growth</div>
            </div>
            
            <div class="pattern-option" data-pattern="weekend-warrior" onclick="selectPattern('weekend-warrior')">
                <div class="pattern-title"> Weekend Warrior Pattern</div>
                <div class="pattern-desc">Weekend spikes, erratic +25%/-10% weekly growth swings</div>
            </div>
        </div>
        
        <button id="generateBtn">
            <span>subukan</span>
        </button>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB6x0Si8OoiD3UDDMjXgZTMOdfv8neMtik",
            authDomain: "gym-database-f4b61.firebaseapp.com",
            databaseURL: "https://gym-database-f4b61-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gym-database-f4b61",
            storageBucket: "gym-database-f4b61.firebasestorage.app",
            messagingSenderId: "79575587778",
            appId: "1:79575587778:web:55b218534fde16847ad45b",
            measurementId: "G-BGPJNP62J5"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // DOM elements
        const generateBtn = document.getElementById('generateBtn');
        const notification = document.getElementById('notification');
        
        // Pattern data
        const patterns = {
            'double-peak': {
                name: 'Double Peak',
                hourlyMultipliers: [1, 1, 1, 1, 2, 5, 8, 10, 9, 6, 4, 5, 6, 4, 3, 4, 6, 9, 12, 10, 7, 5, 3, 2],
                weeklyGrowth: 15,
                peakHour: '7-9am & 6-8pm',
                description: 'Strong morning and evening peaks'
            },
            'evening-heavy': {
                name: 'Evening Heavy',
                hourlyMultipliers: [1, 1, 1, 1, 2, 3, 4, 5, 4, 3, 4, 5, 6, 5, 4, 5, 8, 12, 15, 14, 10, 6, 3, 2],
                weeklyGrowth: 5,
                peakHour: '6-10pm',
                description: 'Massive evening rush hours'
            },
            'morning-rush': {
                name: 'Morning Rush',
                hourlyMultipliers: [2, 2, 3, 4, 6, 9, 12, 14, 10, 7, 5, 6, 5, 4, 3, 3, 4, 5, 6, 5, 4, 3, 2, 2],
                weeklyGrowth: -8,
                peakHour: '5-10am',
                description: 'Intense morning traffic'
            },
            'weekend-warrior': {
                name: 'Weekend Warrior',
                hourlyMultipliers: [1, 1, 1, 1, 2, 4, 6, 8, 7, 5, 6, 8, 9, 7, 5, 6, 9, 11, 10, 8, 6, 4, 2, 1],
                weeklyGrowth: '¬±15',
                peakHour: 'Weekends',
                description: 'Weekend spikes, erratic growth'
            }
        };
        
        let selectedPattern = 'double-peak';
        
        // Member names
        const firstNames = [
            'Alex', 'Jordan', 'Taylor', 'Casey', 'Morgan', 'Riley', 'Avery', 'Quinn',
            'Blake', 'Dakota', 'Emerson', 'Finley', 'Harley', 'Justice', 'Kai', 'Phoenix',
            'Rowan', 'Sage', 'Skyler', 'Spencer', 'Charlie', 'Drew', 'Eden', 'Elliot',
            'Frankie', 'Gray', 'Harper', 'Jules', 'Kelly', 'Lane', 'Marley', 'Max',
            'Nico', 'Oakley', 'Peyton', 'Reese', 'River', 'Rory', 'Salem', 'Shiloh'
        ];
        
        const lastNames = [
            'Anderson', 'Baker', 'Carter', 'Davis', 'Edwards', 'Foster', 'Graham', 'Harris',
            'Irwin', 'Johnson', 'Keller', 'Lawson', 'Miller', 'Nelson', 'Owens', 'Parker',
            'Quinn', 'Roberts', 'Simpson', 'Thompson', 'Underwood', 'Vance', 'Walker', 'Xavier',
            'Young', 'Zimmer', 'Archer', 'Brooks', 'Chase', 'Drake', 'Flynn', 'Grant',
            'Hunt', 'Jones', 'Knight', 'Lee', 'Mason', 'North', 'Pierce', 'Reed'
        ];
        
        // Initialize
        function init() {
            selectPattern('double-peak');
            
            generateBtn.addEventListener('click', generateData);
            
            // Check Firebase connection
            db.ref('.info/connected').on('value', (snap) => {
                if (snap.val() === true) {
                    console.log('Firebase connected');
                } else {
                    console.log('Firebase disconnected');
                }
            });
        }
        
        // Select pattern
        function selectPattern(pattern) {
            selectedPattern = pattern;
            
            // Update UI
            document.querySelectorAll('.pattern-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`[data-pattern="${pattern}"]`).classList.add('selected');
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.className = 'notification';
            }, 5000);
        }
        
        // Generate data based on selected pattern
        async function generateData() {
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<span>‚è≥ Generating Pattern Data...</span>';
            
            const pattern = patterns[selectedPattern];
            
            console.log(`Starting generation of ${pattern.name} pattern...`);
            
            try {
                // Clear existing data
                console.log('Clearing old data...');
                await new Promise((resolve, reject) => {
                    db.ref('Customers').remove()
                        .then(resolve)
                        .catch(reject);
                });
                console.log('‚úÖ Cleared old data');
                
                const now = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 45); // 45 days history
                
                // Generate 40 members
                const totalMembers = 40;
                let totalVisits = 0;
                
                for (let i = 0; i < totalMembers; i++) {
                    const firstName = firstNames[i % firstNames.length];
                    const lastName = lastNames[i % lastNames.length];
                    const uid = (30000000 + i).toString();
                    
                    // Generate attendance history
                    const attendanceHistory = [];
                    const currentDate = new Date(startDate);
                    
                    while (currentDate <= now) {
                        const dayOfWeek = currentDate.getDay();
                        const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                        
                        // Base visits: 2-3 per day, more on weekends for some patterns
                        let baseVisits = 2 + Math.floor(Math.random() * 2); // 2-3
                        
                        // Adjust for pattern
                        if (selectedPattern === 'weekend-warrior' && isWeekend) {
                            baseVisits += 1; // Extra visit on weekends
                        }
                        
                        for (let v = 0; v < baseVisits; v++) {
                            // Determine hour based on pattern
                            let hour = selectHourByPattern(pattern, isWeekend);
                            
                            const visitDate = new Date(currentDate);
                            visitDate.setHours(hour, Math.floor(Math.random() * 60), 0, 0);
                            
                            // Visit duration: 45-90 minutes
                            const duration = 45 + Math.floor(Math.random() * 45);
                            
                            attendanceHistory.push({
                                checkin: visitDate.toISOString(),
                                checkout: new Date(visitDate.getTime() + duration * 60000).toISOString(),
                                time_spent: duration,
                                date: visitDate.toISOString().split('T')[0]
                            });
                            
                            totalVisits++;
                        }
                        
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    // Create member data
                    const memberData = {
                        personal_info: {
                            firstname: firstName,
                            lastname: lastName,
                            phone: `555-${3000 + i}`,
                            membership_type: Math.random() > 0.3 ? 'regular' : 'student'
                        },
                        membership: {
                            status: 'active',
                            plan: 'regular',
                            plan_display: Math.random() > 0.3 ? 'Regular' : 'Student',
                            monthly_rate: Math.random() > 0.3 ? 800 : 600,
                            payment_amount: Math.random() > 0.3 ? 800 : 600,
                            months_paid: 1,
                            start_date: startDate.toISOString().split('T')[0],
                            end_date: new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            remaining_days: 90,
                            last_updated: now.toISOString().split('T')[0]
                        },
                        gym_data: {
                            uid: parseInt(uid),
                            is_checked_in: Math.random() > 0.85, // 15% chance
                            total_visits: attendanceHistory.length,
                            total_time_spent: attendanceHistory.reduce((sum, visit) => sum + visit.time_spent, 0)
                        },
                        attendance_history: attendanceHistory
                    };
                    
                    // Save to Firebase
                    await new Promise((resolve, reject) => {
                        db.ref('Customers/' + uid).set(memberData)
                            .then(resolve)
                            .catch(reject);
                    });
                    
                    if ((i + 1) % 10 === 0) {
                        console.log(`Generated ${i + 1}/${totalMembers} members`);
                    }
                }
                
                console.log(`Generated ${totalMembers} members with ${totalVisits} total visits`);
                
                // Generate PREDICTION DATA based on pattern
                const nextHour = (now.getHours() + 1) % 24;
                const patternMultiplier = pattern.hourlyMultipliers[nextHour];
                const predictedVisits = Math.max(5, Math.min(30, Math.round(40 * 2.5 / 24 * patternMultiplier * 1.5)));
                
                // Confidence based on pattern stability
                let confidence = 0.7;
                if (selectedPattern === 'weekend-warrior') confidence = 0.5;
                if (selectedPattern === 'double-peak') confidence = 0.8;
                
                await new Promise((resolve, reject) => {
                    db.ref('Trend24h').set({
                        nextHour: predictedVisits,
                        confidence: confidence,
                        timestamp: now.toISOString(),
                        nextHourTime: `${nextHour}:00`,
                        pattern: pattern.name
                    }).then(resolve).catch(reject);
                });
                
                console.log(`Prediction: ${predictedVisits} visitors at ${nextHour}:00`);
                
                // Generate WEEKLY GROWTH DATA based on pattern
                let weeklyGrowth = pattern.weeklyGrowth;
                
                // Add some randomness to growth
                if (typeof weeklyGrowth === 'string') {
                    // For weekend warrior: ¬±15%
                    weeklyGrowth = (Math.random() > 0.5 ? 15 : -10);
                } else {
                    weeklyGrowth += (Math.random() * 6 - 3); // ¬±3% variation
                }
                
                await new Promise((resolve, reject) => {
                    db.ref('WeeklyGrowthRate').set({
                        pct: parseFloat(weeklyGrowth.toFixed(1)),
                        thisWeekSum: Math.round(40 * 7 * (1 + weeklyGrowth/100)),
                        lastWeekSum: 40 * 7,
                        timestamp: now.toISOString(),
                        pattern: pattern.name,
                        trend: weeklyGrowth > 0 ? 'up' : 'down'
                    }).then(resolve).catch(reject);
                });
                
                console.log(`Weekly Growth: ${weeklyGrowth > 0 ? '+' : ''}${weeklyGrowth.toFixed(1)}%`);
                
                // Final success
                showNotification(`${pattern.name} pattern generated successfully!`);
                
                console.log('ang galing');
                
            } catch (error) {
                console.error('Error:', error);
                showNotification('‚ùå Error generating data', 'error');
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span>üöÄ Generate Test Data</span>';
            }
        }
        
        // Select hour based on pattern
        function selectHourByPattern(pattern, isWeekend) {
            const multipliers = pattern.hourlyMultipliers;
            
            // Create weighted distribution
            const totalWeight = multipliers.reduce((a, b) => a + b, 0);
            const weighted = [];
            let cumulative = 0;
            
            for (let i = 0; i < 24; i++) {
                cumulative += multipliers[i];
                weighted[i] = cumulative / totalWeight;
            }
            
            // Random selection based on weights
            const random = Math.random();
            for (let i = 0; i < 24; i++) {
                if (random <= weighted[i]) {
                    return i;
                }
            }
            
            return 17; // Default to 5 PM
        }
        
        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>