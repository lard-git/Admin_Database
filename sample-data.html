<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Sample Data</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getDatabase, ref, set, update } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6x0Si8OoiD3UDDMjXgZTMOdfv8neMtik",
            authDomain: "gym-database-f4b61.firebaseapp.com",
            databaseURL: "https://gym-database-f4b61-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gym-database-f4b61",
            storageBucket: "gym-database-f4b61.firebasestorage.app",
            messagingSenderId: "79575587778",
            appId: "1:79575587778:web:55b218534fde16847ad45b",
            measurementId: "G-BGPJNP62J5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Sample member names
        const sampleNames = [
            { first: "John", last: "Smith" },
            { first: "Maria", last: "Garcia" },
            { first: "David", last: "Johnson" },
            { first: "Sarah", last: "Williams" },
            { first: "James", last: "Brown" },
            { first: "Lisa", last: "Davis" },
            { first: "Michael", last: "Miller" },
            { first: "Emily", last: "Wilson" },
            { first: "Robert", last: "Moore" },
            { first: "Jennifer", last: "Taylor" }
        ];

        // Sample phone numbers
        const samplePhones = [
            "09171234567", "09172345678", "09173456789", "09174567890",
            "09175678901", "09176789012", "09177890123", "09178901234",
            "09179012345", "09170123456"
        ];

        async function generateSampleData() {
            const status = document.getElementById('status');
            status.innerHTML = 'Generating sample data...';
            
            try {
                // First, let's check if we have existing members
                const membersRef = ref(db, 'Customers');
                
                // Generate sample attendance data for the last 30 days
                for (let i = 0; i < sampleNames.length; i++) {
                    const uid = (10000000 + i).toString();
                    const memberData = {
                        personal_info: {
                            firstname: sampleNames[i].first,
                            lastname: sampleNames[i].last,
                            phone: samplePhones[i],
                            uid: parseInt(uid)
                        },
                        membership: {
                            status: "active",
                            plan: "standard",
                            payment_amount: 1500 + (i * 500),
                            months_paid: 3 + (i % 4),
                            start_date: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            end_date: new Date(Date.now() + (30 + i * 7) * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            remaining_days: 30 + (i * 7),
                            last_updated: new Date().toISOString().split('T')[0]
                        },
                        gym_data: {
                            uid: parseInt(uid),
                            is_checked_in: Math.random() > 0.7, // 30% chance of being checked in
                            total_visits: 0,
                            total_time_spent: 0
                        },
                        attendance_history: []
                    };

                    // Generate sample attendance history for the last 30 days
                    const attendanceHistory = [];
                    const today = new Date();
                    
                    for (let day = 0; day < 30; day++) {
                        const visitDate = new Date(today);
                        visitDate.setDate(visitDate.getDate() - day);
                        
                        // 60% chance of visiting on each day
                        if (Math.random() > 0.4) {
                            // Generate 1-3 visits per day (some members come multiple times)
                            const visitsToday = Math.floor(Math.random() * 3) + 1;
                            
                            for (let visit = 0; visit < visitsToday; visit++) {
                                const checkInHour = 6 + Math.floor(Math.random() * 14); // 6 AM to 8 PM
                                const checkInTime = new Date(visitDate);
                                checkInTime.setHours(checkInHour, Math.floor(Math.random() * 60), 0);
                                
                                const stayDuration = 30 + Math.floor(Math.random() * 120); // 30-150 minutes
                                const checkOutTime = new Date(checkInTime.getTime() + stayDuration * 60 * 1000);
                                
                                attendanceHistory.push({
                                    checkin: checkInTime.toISOString(),
                                    checkout: checkOutTime.toISOString(),
                                    time_spent: stayDuration,
                                    date: visitDate.toISOString().split('T')[0]
                                });
                                
                                memberData.gym_data.total_visits++;
                                memberData.gym_data.total_time_spent += stayDuration;
                            }
                        }
                    }
                    
                    memberData.attendance_history = attendanceHistory;
                    
                    // Set last check-in if member is currently checked in
                    if (memberData.gym_data.is_checked_in && attendanceHistory.length > 0) {
                        const latestVisit = attendanceHistory[0]; // Most recent is first
                        memberData.gym_data.last_checkin = latestVisit.checkin;
                    }

                    // Save member to Firebase
                    await set(ref(db, `Customers/${uid}`), memberData);
                    
                    status.innerHTML += `<br>Created member: ${sampleNames[i].first} ${sampleNames[i].last} (UID: ${uid})`;
                }
                
                status.innerHTML += '<br><br><strong>Sample data generation complete!</strong>';
                status.innerHTML += '<br>You can now check your analytics dashboard.';
                
            } catch (error) {
                status.innerHTML = `<br>Error: ${error.message}`;
            }
        }

        // Add button to generate data
        document.addEventListener('DOMContentLoaded', function() {
            const button = document.createElement('button');
            button.textContent = 'Generate Sample Data (10 Members + 30 Days History)';
            button.style.padding = '15px 20px';
            button.style.fontSize = '16px';
            button.style.margin = '20px';
            button.style.backgroundColor = '#9b4de4d3';
            button.style.color = 'white';
            button.style.border = 'none';
            button.style.borderRadius = '5px';
            button.style.cursor = 'pointer';
            
            button.addEventListener('click', generateSampleData);
            
            const status = document.createElement('div');
            status.id = 'status';
            status.style.margin = '20px';
            status.style.padding = '15px';
            status.style.backgroundColor = '#f8f9fa';
            status.style.borderRadius = '5px';
            status.style.fontFamily = 'monospace';
            status.style.whiteSpace = 'pre-wrap';
            
            document.body.appendChild(button);
            document.body.appendChild(status);
        });
    </script>
</head>
<body>
    <h1>Generate Sample Gym Data</h1>
    <p>This will create 10 sample members with 30 days of attendance history.</p>

    <button id="seedAI" style="padding:12px; background:#9b4de4d3; color:#fff; border:none; border-radius:5px; margin:10px;">
  Seed 24h AI Forecast
</button>

<script type="module">
import {db} from './js/database_init.js';
import {set, ref} from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js';

document.getElementById('seedAI').onclick = async () => {
  const hours = {};
  for (let h = 0; h < 24; h++) {
    hours[h] = {
      nextHour: Math.floor(Math.random() * 30 + 5),
      confidence: +(Math.random() * 0.4 + 0.6).toFixed(2)
    };
  }
  // write both the full day and the â€œcurrentâ€ slot the card reads
  const now = new Date().getHours();
  await set(ref(db, 'Trend24h'), {
    ...hours,
    nextHour: hours[now].nextHour,
    confidence: hours[now].confidence
  });
  alert('AI forecast seeded ðŸª„ Reload analytics to peep the numbers.');
};
</script>
</body>
</html>